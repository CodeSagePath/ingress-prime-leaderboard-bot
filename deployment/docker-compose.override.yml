# Development override for Docker Compose
# This file automatically extends docker-compose.yml when present
# Use `docker-compose up` to start development environment

version: '3.8'

services:
  bot:
    build:
      context: .
      dockerfile: Dockerfile.dev
    environment:
      - ENVIRONMENT=development
      - DEBUG=true
      - LOG_LEVEL=DEBUG
      - DB_ECHO=true
      - LOG_TO_FILE=false
      - HEALTH_CHECK_ENABLED=false
      - DASHBOARD_ENABLED=true
      - TEXT_ONLY_MODE=false
    ports:
      - "8080:8080"  # API
      - "8000:8000"  # Dashboard
      - "5678:5678"  # Debug server (if using)
    volumes:
      - .:/app  # Live code mounting
      - bot_dev_data:/app/data
    command: python -m debugpy --listen 0.0.0.0:5678 --wait-for-client main.py
    profiles:
      - debug

  # Redis Commander (Redis GUI for development)
  redis-commander:
    image: rediscommander/redis-commander:latest
    container_name: ingress-bot-redis-gui
    restart: unless-stopped
    environment:
      - REDIS_HOSTS=local:redis:6379
    ports:
      - "8081:8081"
    depends_on:
      - redis
    networks:
      - bot_network
    profiles:
      - tools

  # PgAdmin (PostgreSQL GUI for development)
  pgadmin:
    image: dpage/pgadmin4:latest
    container_name: ingress-bot-pgadmin
    restart: unless-stopped
    environment:
      - PGADMIN_DEFAULT_EMAIL=${PGADMIN_EMAIL:-admin@example.com}
      - PGADMIN_DEFAULT_PASSWORD=${PGADMIN_PASSWORD:-admin}
      - PGADMIN_CONFIG_SERVER_MODE=False
    ports:
      - "5050:80"
    volumes:
      - pgadmin_data:/var/lib/pgadmin
    depends_on:
      - postgres
    networks:
      - bot_network
    profiles:
      - postgres
      - tools

volumes:
  bot_dev_data:
    driver: local

  pgadmin_data:
    driver: local